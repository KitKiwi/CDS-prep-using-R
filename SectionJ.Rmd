---
title: "J. Disciplinary areas of DEGREES CONFERRED"
author: "California State University, East Bay"
date: "generated on `r format(Sys.time(), '%Y-%m-%d')`"
output:
  html_document: default
  pdf_document: default
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhf{}
- \chead{Common Data Set 2020-2021} 
---

```{r include=FALSE}
# R Markdown

#This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

#When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document.

# To successfully Knit to PDF, LaTex needs to be installed on the computer.  See https://miktex.org/ for an installer.  Once it is installed, open MikTex Console, select Settings, and check "Always" under "...missing packages are to be installed automatically" for it to work.

# Start from a clean slate.
rm(list = ls())
```



```{r include=FALSE}
# Install and load packages

if(!require(tidyverse)) install.packages("tidyverse",repos = "http://cran.us.r-project.org")

library(tidyverse)
library(knitr)

# Set current working directory to where I want to save the outputs.  

knitr::opts_knit$set(root.dir = "G:\\My Drive\\AAprojects\\CDSusingR\\2020-2021")

# Create a reference for the directory where the ERS submission files are stored.

ERSdir <- file.path("G:\\My Drive\\AAprojects\\CDSusingR\\2020-2021\\ERS")

```




## Degrees conferred between July 1, 2020 and June 30, 2021

```{r echo=FALSE}

# Read in ERSD files.

ERSDsummer <- read.fwf(file.path(ERSdir, "ERSD\\ERD.PROD.T2020305"), 
                 width = c(-53,1,5),
                 col.names=c('DegreeLevelCode','MajorCode'),
                 colClasses=c('numeric','character'))
ERSDfall_spring <- read.fwf(file.path(ERSdir, "ERSD\\ERD.PROD.T2021205"), 
                     width = c(-53,1,5),
                     col.names=c('DegreeLevelCode','MajorCode'),
                     colClasses=c('numeric','character'))
ERSD <- rbind(ERSDsummer,ERSDfall_spring)
rm(ERSDsummer, ERSDfall_spring)

# Select only Bachelors degrees.

Bachelors <- subset(ERSD, DegreeLevelCode < 5)
rm(ERSD)

# Read in COSAR HEGIS CIP Crossover.

CIPlist <- read.fwf(file.path(ERSdir, "commonc-cosarcipcodefxvw-prd-1.csv"),
                  width = c(5,-1,2,-68,1),
                  col.names=c('MajorCode','CIPcode','Obsolete'),
                  colClasses=c('character','character','numeric'))

# Remove Obsolete codes.

CIPxOver <- subset(CIPlist, Obsolete == 0, select = c('MajorCode','CIPcode'))
rm(CIPlist)

# Read in CDS CIP Category names.

CIPcategory <- read.csv(file.path(FileDir, 'CIPCategory.csv'))

# Join the category names to CIP Code.

CIP <- merge(CIPxOver, CIPcategory, by="CIPcode")
rm(CIPxOver)

# Join the CIP code to degree file.

ERSD <- merge(Bachelors, CIP, by="MajorCode")

# Save the frequencies.

J <- data.frame(table(ERSD$Category))
rm(ERSD)

# Calculate the percent and add total.

J$percent <- (J$Freq/(sum(J$Freq)))*100
J$Var1 <- as.character(J$Var1)
J <- rbind(J, c("Total", colSums(J[,2:3, drop=FALSE])))
J$percent <- sprintf("%.1f%%", as.numeric(J$percent))
colnames(J) <- c("Category","Number","Bachelors")

# Reattach CIP Codes.

Jtable <- merge(J, CIPcategory, by="Category", all=TRUE)
rm(J, CIPcategory)

DegreeTable = subset(Jtable, select = -c(Number))
DegreeTable <-DegreeTable[order(DegreeTable$CIPcode, DegreeTable$Category),]
row.names(DegreeTable) <- NULL
rm(Jtable)

kable(DegreeTable)

```

